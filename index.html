<!DOCTYPE html>
<html>
<head>
  <title>My ToDo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=.25, user-scalable=yes" />
  <meta http-equiv="X-UA-Compatible" content="IE=11">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">    
  <script src="https://unpkg.com/vue"></script>
  <style>
    body {
      background-color:#222222;
      color:#FFFFFF;
    }
    .settings {
      right:11px;
      top:18px;
      position: absolute;
    }
    .settings:hover {
      opacity: .7;
      cursor:pointer;
    }
    .settingsButton {
      float:left;
      font-size: 20px;
    }
    #settingsMenu {
      background-color: #00FF00;
      left:0px;
      top:69px;
      position: fixed;
      width:100%;
      height: auto;
      padding-left: 20px;
      padding-right: 20px;
      padding-top: 12px;
      padding-bottom: 12px;
    }
    .item {
      padding:20px;
      font-size: 25px;
      font-family: Arial, sans-serif;
      border:2px solid #222222;
      color:#FFFFFF;
      background-color:#000000;
      width: calc(100% - 44px);
      height: auto;
      margin-top:-1px;
      left:0px;
    } 
    .item:hover {
      opacity: .7;
      cursor:pointer;
    }
    .itemRemove {
      position: relative;
      width: calc(100% - 200px);
      color:#FFFFFF;
    }
    .price {
      margin-top: 5px;
      right:120px;
      position:absolute;
      width: auto;
      color:#00FF00;
      font-size: 15px;
    } 
    .itemRemove:hover {
      opacity: .7;
      cursor:pointer;
    }
    .input {
      background-color: #333333;
      left:0px;
      top:0px;
      position: fixed;
      width:100%;
      z-index: 100;
    } 
    .menu {
      margin-top: 80px;
    }
    input {
      font-size: 20px;
      width:calc(100% - 100px);
      margin: 20px;
    }
    select {
      margin-top:3px;
      right:20px;
      position:absolute;
    }
    .optionFont {
      font-size: 30px;
    }

  </style>
</head>
<body>
  <div id="app">
    <div class="input">
      <input v-model="newTodoText" v-on:keyup.enter="addTodo" placeholder="Add items">
      <image class="settings" src="assets/menu.png" v-on:click="toggleSettings()"/>
    </div>
    <div class="menu">
      <div class="item" v-for="(todo, index) in todos">
        <span class="itemRemove" v-bind:style="{ fontSize: fontSize + 'px' }" v-on:click="removeTodo(index)">
          {{ todo.title }}
        </span>
        <span class="price">
            ${{ todo.price }}
        </span>
        <select id="indexSelector" v-model="todo.aisle" v-on:change="reIndex(index, todo.aisle)">
          <option v-for="(aisle, selectedId) in aisles" :value="aisles[selectedId]" class="optionFont" v-if="aisles[selectedId] == todo.aisle">
              {{ aisles[selectedId] }}
          </option>
          <option v-for="(aisle, selectIndex) in aisles" :value="aisles[selectIndex]" class="optionFont" v-if="aisles[selectIndex] !== todo.aisle">
            {{ aisles[selectIndex] }}
          </option>
        </select>
      </div>
    </div>
    <div id="settingsMenu">
      <button class="settingsButton" v-for="(setting, index) in settings" v-on:click="getSetting(index)">
          {{ settings[index] }}
      </button>
    </div>
  </div>

  <script>

    var app = new Vue({
      el: '#app',
      data: {
        fontSize: 25,
        todos: [],
        todoSort: [],
        itemMenuDefault: ["Add Index", "Edit", "Price", "Delete"],
        aisles: [],
        retrievedData: "",
        settings: [
          "Font Size",
          "Save", 
          "Restore", 
          "Clear", 
          "Revert"
        ],
        newItem: {title: '', aisle: ''},
        newTodoText: '',
        newAisle: '',
      },
      created: function () {
        this.todos = [];
        if (!localStorage.getItem("vueTodos")) {
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        } else {
          this.retrievedData = localStorage.getItem("vueTodos");
          this.todos = JSON.parse(this.retrievedData);
          this.updateAisles();
          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
        }
        if (!localStorage.getItem("fontSize")) {
          localStorage.setItem("fontSize", this.fontSize);
        } else {
          this.fontSize = localStorage.getItem("fontSize");
        }
        this.toggleSettings();
      },
      methods: {
        addTodo: function () {
          if (this.newTodoText) {
            this.newAisle = prompt("Enter aisle number:", "");
            if(this.aisles.indexOf(this.newAisle) < 0){
              this.aisles.push(this.newAisle);
            }
            localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
            this.newItem = {title: this.newTodoText, aisle: this.newAisle, price: 0.00};
            this.todos.push(this.newItem);
            this.retrievedData = localStorage.getItem("vueTodos");
            this.retrievedData = JSON.parse(this.retrievedData);
            this.retrievedData.push(this.newItem);
            this.updateAisles();
            localStorage.setItem("vueTodos", JSON.stringify(this.retrievedData));
            this.newTodoText = ''
          }
        },
        removeTodo: function (index) {
//          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
          this.todos.splice(index, 1)
        },
        toggleSettings: function () {
          if (document.getElementById("settingsMenu").style.visibility == "hidden") {
            document.getElementById("settingsMenu").style.visibility = "visible";
          } else {
            document.getElementById("settingsMenu").style.visibility = "hidden";
          }
        },
        reIndex: function (index, selectedAisle) {
//          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
          if (selectedAisle == "Delete") {
            this.todos.splice(index, 1); 
          } else if (selectedAisle == "Price") {
            this.todos[index].price = prompt("Enter price:", "");
           // this.updateAisles();
          } else if (selectedAisle == "Edit") {
            this.todos[index].title = prompt("Enter new label:", this.todos[index].title);
            selectedAisle = prompt("Enter aisle number:", this.todos[index].aisle);
            if(this.aisles.indexOf(selectedAisle) < 0){
              this.aisles.push(selectedAisle);
            }
            this.todos[index].aisle = selectedAisle;
            this.updateAisles();
          } else {
            if (selectedAisle == "Add Index") {
              selectedAisle = prompt("Enter aisle number:", "");
              if(this.aisles.indexOf(selectedAisle) < 0){
                this.aisles.push(selectedAisle);
              }
            }
            this.todos[index].aisle = selectedAisle;
            this.updateAisles();
          }
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        },
        getSetting: function(index) {
          if (this.settings[index] == "Clear") {
            this.clear();
          } else if (this.settings[index] == "Font Size") {
            this.fontSize = prompt("Enter font size", this.fontSize);
            localStorage.setItem("fontSize", this.fontSize);
          } else if (this.settings[index] == "Revert") {
            this.revert();
          } else if (this.settings[index] == "Save") {
            this.save();
          } else if (this.settings[index] == "Restore") {
            this.restore();
          }
          this.toggleSettings();
        },
        clear: function () {
          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
          this.todos = [];
          this.aisles = [];
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        },
        sortArray: function (array) {
          let alphabetic = [];
          let numeric = [];
          let n=0;
          for (n in array){
            if (Number(array[n].substring(0,1)) > 0) {
              numeric.push(array[n]);
            } else {
              alphabetic.push(array[n]);
            }
          }

          alphabetic.sort();
          numeric.sort(function(a, b){return a - b});
          array = [];
          n=0;
          for (n in this.itemMenuDefault) {
            array.push(this.itemMenuDefault[n])
          }
          n=0;
          for (n in alphabetic) {
            if(array.indexOf(alphabetic[n]) < 0){
              array.push(alphabetic[n])
            }
          }
          n=0;
          for (n in numeric) {
            array.push(numeric[n])
          }
            this.aisles = array;
        },
        updateAisles: function () {
          for (x in this.todos) {
            if(this.aisles.indexOf(this.todos[x].aisle) < 0){
              this.aisles.push(this.todos[x].aisle);
            }
          }
          this.sortArray(this.aisles);
          this.todoSort = [];
          for (a in this.aisles) {
            for (t in this.todos) {
              if (this.todos[t].aisle == this.aisles[a]) {
                this.todoSort.push(this.todos[t]);
              }
            }
          }
          this.todos = this.todoSort;
        },
        revert: function () {
          this.retrievedData = localStorage.getItem("vueTodosRevert");
          this.todos = JSON.parse(this.retrievedData);
          for (n in this.itemMenuDefault) {
            this.aisles.push(this.itemMenuDefault[n])
          }
          this.updateAisles();
          //localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        },
        save: function () {
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        },
        restore: function () {
          this.retrievedData = localStorage.getItem("vueTodosRevert");
          this.todos = JSON.parse(this.retrievedData);
          for (n in this.itemMenuDefault) {
            this.aisles.push(this.itemMenuDefault[n])
          }
          this.updateAisles();
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        }
      }
    })
    
  </script>
</body>
</html>
