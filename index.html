<!DOCTYPE html>
<html>
<head>
  <title>My ToDo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=.25, user-scalable=yes" />
  <meta http-equiv="X-UA-Compatible" content="IE=11">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">    
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png" />
  <link rel="shortcut icon" sizes="196x196" href="icon-196x196.png">
  <link rel="icon" sizes="192x192" href="js_icon_192.png">
  <script src="https://unpkg.com/vue"></script>
  <style>
    body {
      background-color:#222222;
      color:#FFFFFF;
      margin:0px;
    }
    .settings {
      right:11px;
      top:18px;
      position: absolute;
    }
    .settings:hover {
      opacity: .7;
      cursor:pointer;
    }
    .settingsButton {
      float:left;
      font-size: 20px;
    }
    #settingsMenu {
      background-color: #00FF00;
      left:0px;
      top:69px;
      position: fixed;
      width:100%;
      height: auto;
      padding-left: 20px;
      padding-right: 20px;
      padding-top: 12px;
      padding-bottom: 12px;
    }
    .itemOld {
      padding:20px;
      font-size: 25px;
      font-family: Arial, sans-serif;
      border:2px solid #222222;
      color:#FFFFFF;
      background-color:#000000;
      width: calc(100% - 44px);
      height: auto;
      margin-top:-1px;
      left:0px;
    } 
    .item {
      font-size: 25px;
      font-family: Arial, sans-serif;
      color:#FFFFFF;
      background-color:#000000;
      width: 100%;
      height: 90px;
      left:0px;
      position: relative;
    } 
    .item:hover {
      opacity: .7;
      cursor:pointer;
    }
    .itemSelected {
      font-size: 25px;
      font-family: Arial, sans-serif;
      color:#FFFF00;
      background-color:#095a02;
      width: 100%;
      height: 90px;
      left:0px;
      position: relative;
    } 
    .itemDollars {
      float: left;
      position: relative;
    }
    .itemSelectors {
      background-color:#111111;
      left:0px;
      padding:10px;
      width: calc(100% - 22px);
      border:1px solid #000000;
      position:relative;
      color: #BBBBBB;
      font-size:12px;
      text-align: right;
    }
    .itemRemove {
      padding: 10px;
      left:0px;
      position:relative;
      color:#FFFFFF;
    }
    .itemRemove:hover {
      opacity: .7;
      cursor:pointer;
    }
    .price {
      margin-top: 3px;
      float: left;
      width: auto;
    }
    .input {
      background-color: #333333;
      left:0px;
      top:0px;
      position: fixed;
      width:100%;
      z-index: 100;
    }
    #indexSelector {
      margin-left:3px;
    }
    #quantitySelector {
      margin-left:3px;
    }
    .menu {
      width: 100%;
      left:0px;
      margin-top: 70px;
      margin-bottom: 80px;
    }
    .inputItem {
      font-size: 20px;
      width:calc(100% - 100px);
      margin: 20px;
    }
    select {
      float: right;
    }
    .total {
      position: fixed;
      bottom:0px;
      padding: 10px;
      width: calc(100% - 20px);
      background-color: #333333;
      height: auto;
    }
    .totalItems {
      color:#CCCCCC;
      font-weight:bolder;
      left:20px;
      text-align: right;
      position: absolute;
    }
    .totalDollars {
      color:#CCCCCC;
      font-weight:bolder;
      right: 0px;
      text-align: right;
      position: relative;
    }
    .optionFont {
      font-size: 30px;
    }
    .taxLabel {
      font-size: 9px;
    }
    #indexSelection {
        top:0px;
        position: relative;
        float: right;
    }
    #quantitySelection {
      top:0px;
      position: relative;
      float: right;
    }
    .selectionLabel {
      position:relative;
      margin-left: 5px;
    }
    .tax {
      top:-2px;
      position:relative;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="input">
      <input class="inputItem" v-model="newTodoText" v-on:keyup.enter="addTodo" placeholder="Add items">
      <image class="settings" src="assets/menu.png" v-on:click="toggleSettings()"/>
    </div>
    <div class="menu">
      <div class="item" v-for="(todo, index) in todos">
        <div class="itemRemove" v-bind:style="{ fontSize: fontSize + 'px' }" v-on:click="toggleCart(index)">
          {{ todo.title }}
          <image class="settings" src="assets/cart.png" v-if="todo.cart"/>
          <image class="settings" src="assets/addToCart.png" v-if="!todo.cart"/>
        </div>
        <div class="itemSelectors">
            <span class="selectionLabel">Tax:</span>
            <input type="checkbox" id="tax" v-model="todo.tax" v-on:change="toggleTax(index)">
          <div id="quantitySelection">
            <span class="selectionLabel">Count:</span>
            <select id="quantitySelector" v-model="todo.quantity" v-on:change="getTotal()">
              <option v-for="(quantity, selectedQuantity) in quantities" :value="quantities[selectedQuantity]" class="optionFont" v-if="quantities[selectedQuantity] == todo.quantity">
                  {{ quantities[selectedQuantity] }}
              </option>
              <option v-for="(quantity, selectQuantity) in quantities" :value="quantities[selectQuantity]" class="optionFont" v-if="quantities[selectQuantity] !== todo.quantity">
                  {{ quantities[selectQuantity] }}
              </option>
            </select>
          </div>
          <div id="indexSelection">
              <span class="selectionLabel">Aisle:</span>
            <select id="indexSelector" v-model="todo.aisle" v-on:change="reIndex(index, todo.aisle)">
              <option v-for="(aisle, selectedId) in aisles" :value="aisles[selectedId]" class="optionFont" v-if="aisles[selectedId] == todo.aisle">
                  {{ aisles[selectedId] }}
              </option>
              <option v-for="(aisle, selectIndex) in aisles" :value="aisles[selectIndex]" class="optionFont" v-if="aisles[selectIndex] !== todo.aisle">
                {{ aisles[selectIndex] }}
              </option>
            </select>
          </div>
          <div class="itemDollars">
            <span class="price">
              ${{ todo.price }}
            </span>
          </div>
        </div>
        <br>
      </div>
      <div class="item total">
          <div class="totalItems" v-bind:style="{ fontSize: fontSize + 'px' }">
            Items: {{ items }}<br>total: {{ totalItems }}
          </div>
          <div class="totalDollars" v-bind:style="{ fontSize: fontSize + 'px' }">
            Tax: $ {{ taxTotal }}<br>Total: $ {{ total }}
          </div>
      </div>
    </div>
    <div id="settingsMenu">
      <button class="settingsButton" v-for="(setting, index) in settings" v-on:click="getSetting(index)">
          {{ settings[index] }}
      </button>
    </div>
  </div>

  <script>

    var app = new Vue({
      el: '#app',
      data: {
        fontSize: 25,
        tax: 7.75,
        todos: [],
        todoSort: [],
        itemMenuDefault: ["Add Index", "Edit", "Price", "Delete"],
        aisles: [],
        quantities: [0,1,2,3,4,5,6,7,8,9,10],
        retrievedData: "",
        settings: [
          "Font Size",
          "Save", 
          "Restore", 
          "Clear", 
          "Revert"
        ],
        newItem: {title: '', aisle: '', price: '', quantity: '', tax: false, cart: false},
        ogTitle: '',
        newTodoText: '',
        newAisle: '',
        newPrice: '',
        total: 0,
        taxTotal: 0,
        items: 0,
        totalItems: 0,
      },
      created: function () {
        this.todos = [];
        if (!localStorage.getItem("vueTodos")) {
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        } else {
          this.retrievedData = localStorage.getItem("vueTodos");
          this.todos = JSON.parse(this.retrievedData);
          this.updateAisles();
          this.updatePrice();
          this.updateCart();
          this.updateQuantity();
          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
        }
        if (!localStorage.getItem("fontSize")) {
          localStorage.setItem("fontSize", this.fontSize);
        } else {
          this.fontSize = localStorage.getItem("fontSize");
        }
        this.toggleSettings();
        this.getTotal();
      },
      methods: {
        addTodo: function () {
          if (this.newTodoText) {
            this.newAisle = prompt("Enter aisle number:", "");
            if(this.aisles.indexOf(this.newAisle) < 0){
              this.aisles.push(this.newAisle);
            }
            this.newPrice = prompt("Enter price:", "");
            localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
            this.newItem = {title: this.newTodoText, aisle: this.newAisle, price: Number(this.newPrice).toFixed(2), quantity: 1, tax: false, cart: false};
            this.todos.push(this.newItem);
            this.retrievedData = localStorage.getItem("vueTodos");
            this.retrievedData = JSON.parse(this.retrievedData);
            this.retrievedData.push(this.newItem);
            this.updateAisles();
            localStorage.setItem("vueTodos", JSON.stringify(this.retrievedData));
            this.retrievedData = localStorage.getItem("vueTodosSaved");
            this.retrievedData = JSON.parse(this.retrievedData);
            this.retrievedData.push(this.newItem);
            localStorage.setItem("vueTodosSaved", JSON.stringify(this.retrievedData));
            this.newTodoText = '';
            this.getTotal();
          }
        },
        toggleCart: function (index) {
//          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
          if (this.todos[index].cart) {
            this.todos[index].cart = false;
          } else {
            this.todos[index].cart = true;
          }
          this.getTotal();
        },
        toggleSettings: function () {
          if (document.getElementById("settingsMenu").style.visibility == "hidden") {
            document.getElementById("settingsMenu").style.visibility = "visible";
          } else {
            document.getElementById("settingsMenu").style.visibility = "hidden";
          }
        },
        reIndex: function (index, selectedAisle) {
//          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
          if (selectedAisle == "Delete") {
            this.retrievedData = localStorage.getItem("vueTodosSaved");
            this.retrievedData = JSON.parse(this.retrievedData);
            for (x in this.retrievedData) {
              if (this.retrievedData[x].title == this.todos[index].title) {
                this.retrievedData.splice(x, 1);
              }
            }
            localStorage.setItem("vueTodosSaved", JSON.stringify(this.retrievedData));
            this.todos.splice(index, 1);
          } else if (selectedAisle == "Price") {
            this.todos[index].price = Number(prompt("Enter price:", "")).toFixed(2);
            //selectedAisle = prompt("Enter aisle number:", this.todos[index].aisle);
            //if(this.aisles.indexOf(selectedAisle) < 0){
              //this.aisles.push(selectedAisle);
            //}
            
            this.retrievedData = localStorage.getItem("vueTodosSaved");
            this.retrievedData = JSON.parse(this.retrievedData);
            for (x in this.retrievedData) {
              if (this.retrievedData[x].title == this.todos[index].title) {
                this.retrievedData[x].price = this.todos[index].price;
                this.todos[index].aisle = this.retrievedData[x].aisle;
              }
            }
            this.updateAisles();
            localStorage.setItem("vueTodosSaved", JSON.stringify(this.retrievedData));
          } else if (selectedAisle == "Edit") {
            this.ogTitle = this.todos[index].title;
            this.todos[index].title = prompt("Enter new label:", this.todos[index].title);
            selectedAisle = prompt("Enter aisle number:", this.todos[index].aisle);
            if(this.aisles.indexOf(selectedAisle) < 0){
              this.aisles.push(selectedAisle);
            }
            this.todos[index].aisle = selectedAisle;
            this.retrievedData = localStorage.getItem("vueTodosSaved");
            this.retrievedData = JSON.parse(this.retrievedData);
            for (x in this.retrievedData) {
              if (this.retrievedData[x].title == this.ogTitle) {
                this.retrievedData[x].title = this.todos[index].title;
                this.retrievedData[x].aisle = this.todos[index].aisle;
              }
            }
            this.updateAisles();
            localStorage.setItem("vueTodosSaved", JSON.stringify(this.retrievedData));
            this.ogTitle = "";
          } else {
            if (selectedAisle == "Add Index") {
              selectedAisle = prompt("Enter aisle number:", "");
              if(this.aisles.indexOf(selectedAisle) < 0){
                this.aisles.push(selectedAisle);
              }
            }
            this.todos[index].aisle = selectedAisle;
            this.retrievedData = localStorage.getItem("vueTodosSaved");
            this.retrievedData = JSON.parse(this.retrievedData);
            for (x in this.retrievedData) {
              if (this.retrievedData[x].title == this.todos[index].title) {
                this.retrievedData[x].aisle = selectedAisle;  
              }
            }
            localStorage.setItem("vueTodosSaved", JSON.stringify(this.retrievedData));
            this.updateAisles();
          }
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
          this.getTotal()
        },
        getSetting: function(index) {
          if (this.settings[index] == "Clear") {
            this.clear();
          } else if (this.settings[index] == "Font Size") {
            this.fontSize = prompt("Enter font size", this.fontSize);
            localStorage.setItem("fontSize", this.fontSize);
          } else if (this.settings[index] == "Revert") {
            this.revert();
          } else if (this.settings[index] == "Save") {
            this.save();
          } else if (this.settings[index] == "Restore") {
            this.restore();
          }
          this.toggleSettings();
        },
        clear: function () {
          localStorage.setItem("vueTodosRevert", JSON.stringify(this.todos));
          this.todos = [];
          this.aisles = [];
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
          this.getTotal();
        },
        sortArray: function (array) {
          let alphabetic = [];
          let numeric = [];
          let n=0;
          for (n in array){
            if (Number(array[n].substring(0,1)) > 0) {
              numeric.push(array[n]);
            } else {
              alphabetic.push(array[n]);
            }
          }

          alphabetic.sort();
          numeric.sort(function(a, b){return a - b});
          array = [];
          n=0;
          for (n in this.itemMenuDefault) {
            array.push(this.itemMenuDefault[n])
          }
          n=0;
          for (n in alphabetic) {
            if(array.indexOf(alphabetic[n]) < 0){
              array.push(alphabetic[n])
            }
          }
          n=0;
          for (n in numeric) {
            array.push(numeric[n])
          }
            this.aisles = array;
        },
        updateAisles: function () {
          for (x in this.todos) {
            if(this.aisles.indexOf(this.todos[x].aisle) < 0){
              this.aisles.push(this.todos[x].aisle);
            }
          }
          this.sortArray(this.aisles);
          this.todoSort = [];
          for (a in this.aisles) {
            for (t in this.todos) {
              if (this.todos[t].aisle == this.aisles[a]) {
                this.todoSort.push(this.todos[t]);
              }
            }
          }
          this.todos = this.todoSort;
        },
        updatePrice: function () {
          for (x in this.todos) {
            if (this.todos[x].price == undefined) {
              this.todos[x].price = Number(0).toFixed(2);
            }
          }
          this.getTotal();
        },
        updateQuantity: function () {
          for (x in this.todos) {
            if (this.todos[x].quantity == undefined) {
              this.todos[x].quantity = this.quantities[1];
            }
          }
        },
        toggleTax: function(index) {          
          this.retrievedData = localStorage.getItem("vueTodosSaved");
          this.retrievedData = JSON.parse(this.retrievedData);
          for (x in this.retrievedData) {
            if (this.retrievedData[x].title == this.todos[index].title) {
              this.retrievedData[x].tax = this.todos[index].tax;
            }
          }
          localStorage.setItem("vueTodosSaved", JSON.stringify(this.retrievedData));
          this.getTotal();
        },
        updateTax: function () {
          for (x in this.todos) {
            if (this.todos[x].tax == undefined) {
              this.todos[x].tax = false;
            }
          }
        },
        updateCart: function () {
          for (x in this.todos) {
            if (this.todos[x].cart == undefined) {
              this.todos[x].cart = false;
            }
          }
        },
        revert: function () {
          this.retrievedData = localStorage.getItem("vueTodosRevert");
          this.todos = JSON.parse(this.retrievedData);
          for (n in this.itemMenuDefault) {
            this.aisles.push(this.itemMenuDefault[n])
          }
          this.updateAisles();
          //localStorage.setItem("vueTodos", JSON.stringify(this.todos));
          this.getTotal();
        },
        save: function () {
          localStorage.setItem("vueTodosSaved", JSON.stringify(this.todos));
        },
        restore: function () {
          this.retrievedData = localStorage.getItem("vueTodosSaved");
          this.todos = JSON.parse(this.retrievedData);
          for (n in this.itemMenuDefault) {
            this.aisles.push(this.itemMenuDefault[n])
          }
          this.updateAisles();
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
          this.getTotal();
        },
        getTotal: function () {
          this.total = Number(0);
          let subtotal = 0;
          let tax = this.tax;
          this.taxTotal = 0;
          this.items = 0;
          this.totalItems = 0;
          for (n in this.todos) {
            if (this.todos[n].price != undefined && this.todos[n].cart) {
              this.items++;
              this.totalItems = Number(this.totalItems) + Number(this.todos[n].quantity);
              subtotal = parseFloat(Number(this.todos[n].price)) * Number(this.todos[n].quantity);
              if (this.todos[n].tax) {
                tax = subtotal * (Number(this.tax) * .01);
                this.taxTotal = this.taxTotal + tax;
                subtotal = subtotal + tax;
              }
              this.total = parseFloat(Number(this.total)) + subtotal;
            }
          }
          this.total = Math.round( this.total * 100 ) / 100;
          this.total = this.total.toFixed(2);
          //this.total = Math.round( this.total * 100 ) / 100;
          this.taxTotal = this.taxTotal.toFixed(2);
          localStorage.setItem("vueTodos", JSON.stringify(this.todos));
        }
      }
    })
    
  </script>
</body>
</html>